# {{ ansible_managed }}
# Clusters configuration

  clusters:
  {% for cluster in envoy_clusters %}
    - name: {{ cluster.name }}
      connect_timeout: {{ cluster.connect_timeout | default('0.25s') }}
      type: {{ cluster.type | default('STATIC') }}
      lb_policy: {{ cluster.lb_policy | default('ROUND_ROBIN') }}
      load_assignment:
        cluster_name: {{ cluster.name }}
        endpoints:
          - lb_endpoints:
            {% for endpoint in cluster.endpoints %}
              - endpoint:
                  address:
                    socket_address:
                      address: {{ endpoint.address }}
                      port_value: {{ endpoint.port }}
            {% endfor %}
  {% endfor %} 